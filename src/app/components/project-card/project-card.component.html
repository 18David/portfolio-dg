<div
  class="bg-secondary rounded-2xl shadow-md overflow-hidden flex flex-col h-full"
>
  <!-- Media -->
  <!--div class="w-full h-56 bg-primary relative overflow-hidden border border-2 border-b-0 rounded-t-2xl border-accent">
    @for (media of project.media; track media.src; let  i = $index) {
      @if (media.type === 'image' && i === 0) {
        <img [src]="media.src"
            [alt]="project.title"
            class="w-full h-full object-cover" />
      }
      @if (media.type === 'video' && i === 0) {
        <iframe [src]="media.src | safeUrl"
            class="w-full h-full aspect-video object-cover"
            frameborder="0"
            allow="autoplay; encrypted-media"
            allowfullscreen>
        </iframe>
      }
    }
  </div-->
  <!-- ===== Media / Carousel ===== -->
  <div
    class="relative overflow-hidden group/carousel select-none border bg-primary border-2 border-b-0 rounded-t-2xl border-accent"
    (mouseenter)="hovering = true"
    (mouseleave)="hovering = false"
  >
    <!-- Aspect ratio 16:9 -->
    <div class="w-full aspect-video overflow-hidden">
      @for (m of project.media; track m.src; let i = $index) {
      <div
        class="absolute inset-0 transition-opacity duration-500"
        [class.opacity-0]="i !== current"
        [class.opacity-100]="i === current"
      >
        @if (m.type === 'image') {
        <img
          [src]="m.src"
          [alt]="project.title"
          class="w-full h-full object-cover"
        />
        } @if (m.type === 'video') {
        <!-- YouTube / Vimeo embed -->
        <iframe
          [src]="m.src | safeUrl"
          class="w-full h-full"
          frameborder="0"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
          allowfullscreen
        >
        </iframe>
        }
      </div>
      }
    </div>

    <!-- Arrows (discrètes + visibles au hover) -->
    @if (hasMultiple) {
    <div class="absolute inset-0 flex items-center justify-between px-3">
      <button
        type="button"
        (click)="prev(true)"
        mat-button
        class="mech-btn primary opacity-0 group-hover/carousel:opacity-100 transition-opacity w-9 h-9 grid place-items-center"
      >
        <span class="sr-only">Slide précédente</span>
        <svg viewBox="0 0 24 24" class="w-4 h-4 fill-current">
          <path d="M15.41 7.41 14 6l-6 6 6 6 1.41-1.41L10.83 12z" />
        </svg>
      </button>

      <button
        type="button"
        (click)="next(true)"
        class="mech-btn primary opacity-0 group-hover/carousel:opacity-100 transition-opacity w-9 h-9 grid place-items-center"
      >
        <span class="sr-only">Slide suivante</span>
        <svg viewBox="0 0 24 24" class="w-4 h-4 fill-current">
          <path d="M8.59 16.59 13.17 12 8.59 7.41 10 6l6 6-6 6z" />
        </svg>
      </button>
    </div>
    }

    <!-- Barre segmentée (progress) -->
    @if (hasMultiple) {
    <div class="absolute inset-x-0 bottom-0 px-4 pb-2">
      <div class="flex gap-2">
        @for (m of project.media; track m.src; let i = $index) {
        <div class="h-1.5 flex-1 rounded-full bg-primary/30 overflow-hidden">
          <div class="h-full bg-accent" [style.width.%]="segmentFill(i)"></div>
        </div>
        }
      </div>
    </div>
    }
  </div>
  <h3
    class="font-title text-lg font-semibold text-accent border border-2 border-t-0 rounded-b-2xl border-accent bg-primary px-4 py-2"
  >
    {{ project.title }}
  </h3>

  <!-- Infos -->
  <div class="p-4 flex flex-col gap-2 flex-1">
    <p class="font-body text-sm text-primary flex-1">
      {{ project.description }}
    </p>

    <div class="flex flex-wrap gap-2 mt-2">
      @for (keyword of project.keywords; track keyword) {
      <span class="px-2 py-1 rounded-full text-xs bg-primary text-secondary">
        {{ keyword }}
      </span>
      }
    </div>
    <button mat-button class="mech-btn primary" (click)="toggleDetails()">
      @if (!showDetails) { Plus de détails } @else { Moins de détails }
    </button>

    @if (showDetails) {
    <div class="mt-3 text-xs text-primary space-y-1">
      <p>Année : {{ project.date | date : "yyyy" }}</p>
      @if (project.duration) {
      <p>Durée : {{ project.duration }}</p>
      }
      <p>Fait avec : {{ project.madeWith.join(", ") }}</p>
      <p>Fait pour : {{ project.madeFor }}</p>
    </div>
    }
  </div>
</div>
